title: Token
author: 乔丁
tags:
  - 前端
categories: 
  - web
date: 2018-04-27 22:18:00
description: 了解第三方认证时候用到了token，系统的总结一下
photos: http://p7wm7amg2.bkt.clouddn.com/token.png
---

## 简介
token意思是“令牌”，是服务端生成的一串字符串，作为客户端进行请求的一个标识。

用户第一次登录，服务器生成一个token并将此token返回给客户端，以后客户端只需带上这个token前来请求数据即可，无需再次带上用户名和密码

**toke组成：**
	*uid（用户唯一的身份标识）*
	*time（当前时间的时间戳）*
	*sign（签名，token的前几位以哈希算法压缩成的一定长度的十六进制字符串。为防止token泄露）*
	

token在服务端不需要存储用户的登录记录，流程：
1、客户端使用用户名和密码请求登录
2、服务端收到请求，验证用户名和密码
3、验证成功后，*服务端会生成一个token*，然后把这个token发送给客户端
4、*客户端收到token后把他存储起来*，可以放在cookie或者LocalStroage里
5、客户端每次向服务器请求时都需要带上服务器发给的token
6、服务端收到请求，然后去验证客户端请求里面带着token，如果验证成功，就向客户端返回请求的数据

token机制认证登录方式：
*1、用Mac地址作为token*
*客户端*：客户端在登录时获取设备的Mac地址，将其作为参数传递到服务端
*服务端*：服务端接收到该参数后，便用一个变量来接收，同时将其作为token保存在数据库

*2、用sessionId作为token*
*客户端*：客户端携带用户名和密码登录
*服务端*：接收到用户名和密码后进行校验，正确
就将本地获取的sessionId作为token返回给客户端，客户端以后只需带上请求的数据即可。这样不用存储数据，但是session过期客户端必须重新登录

保密性高的话，两个都用上。
将设备的Mac地址与用户名密码同时作为token进行认证

把token用在https


## Token的优点
token相对于cookie机制的好处
**1、支持跨域访问**：cookie不允许跨域访问的，这一点对token机制是不存在的，前提是传输的用户认证信息通过HTTP头传输
**2、无状态**：token机制在服务端不需要存储session信息，因为token自身包含了所有登录用户的信息，只需要在客户端的cookie或本地介质存储状态信息
**3、更适用CDN**：可以通过内容分发网络请求你服务端的所有资料，而你的服务端只要提供API即可

## token过程

第三方认证登录过程：
1、用户选择使用第三方认证登录
2、我的服务器给客户端返回第三方的连接，在连接中带上认证的id
3、客户端请求第三方链接
4、第三方链接返回登录和授权
5、客户端登录第三方
6、第三方携带一个授权码，并返回我的服务器链接
7、客户端携带授权码请求我的服务器
8、我的服务器得到授权码
9、我的服务器拿着授权码去请求第三方的token
10、第三方拿到授权码并验证，验证后创建token
11、第三方把token再返回给我的服务器
12、得到token用于之后的验证

授权码的安全：
1、和我的服务器申请的appid、appsecret相关，第三方只认申请过的，才给token
2、让授权码有时间限制
3、授权码只能换一次token
