title: HTTP/2
author: 乔丁
tags:
  - 计算机网络
categories:
  - net
date: 2018-06-20 12:12:12
description: 啊啊啊啊啊五环
photos: http://p0.meituan.net/xianfu/508467c6250a747b69ad5a2eba1d7e7b38468.png
---

## 首先
不是HTTP/1.x的重写
HTTP/2基于SPDY3，专注于性能，最大的目标实在用户和网站之间只用一个连接

## SPDY
> SPeeDY Google开发基于TCP的应用层协议。用以最小化网络延迟，提升网络速度，优化用户的网络使用体验。
> SPDY并不是一种用于替代HTTP的协议，而是对HTTP协议的增强。
> 新协议的功能包括数据流的多路复用、请求优先级以及HTTP报头压缩。
> 谷歌表示，引入SPDY协议后，在实验室测试中页面加载速度比原先快64%

* 单个TCP连接支持并发的HTTP请求。
* 压缩报头和去掉不必要的头部来减少当前HTTP使用的带宽。
* 定义一个容易实现，在服务器端高效率的协议。通过减少边缘情况、定义易解析的消息格式来减少HTTP的复杂性。
* 强制使用SSL，让SSL协议在现存的网络设施下有更好的安全性和兼容性。
* 允许服务器在需要时发起对客户端的连接并推送数据。

所以HTTP/2和HTTPS是包含关系

#### SPDY原理
强制使用了SSL，在SSL层上增加一个SPDY会话层，以在一个TCP连接中实现并发流
通常的HTTP get和post格式仍是一样的，然而SPDY为编码和传输数据设计了一个新的帧格式

#### SPDY基本特征
复用流：SPDY允许在一个连接上无限制并发流。因为请求在一个通道上，TCP效率更高；更少的网络连接，发出更少更密集的数据包
请求优先级：虽然无限的并发流解决了序列化的问题，但如果带宽通道受限制，客户端可能会因防止阻塞通道而阻止请求。SPDY实行请求优先级：客户端从服务器端请求它希望的项目数量，并为每个请求分配一个优先级。这可以防止在网络通道被非关键资源堵塞时，高优先级的请求被挂起
HTTP报头压缩：SPDY压缩请求和响应HTTP报头，从而减少传输的数据包数量和字节数

#### SPDY高级特征
服务器启动流：能分发内容到客户端，不需要客户端发起请求。此选项可以由Web开发人员通过如下两种方式配置：
1、Server push：SPDY通过X-Associated-Content头试验了服务器推送数据给客户端的选项。这个头告诉客户端服务器将在客户端请求资源之前，推送资源给它。对于初始页面下载（例如用户初次访问这个网站），这样能大大提升用户体验。
2、Server hint：相对于自动推送资源到客户端，在服务器事先知道客户端需要的资源的情况下，服务器使用X-Subresources头建议客户端请求特殊的资源。但是，服务器仍然在发送内容前等待客户请求。通过窄带，这个选项能减少一个客户端发现它所需要的资源的数百毫秒，可能更适合于非初始页面加载。

SPDY并不用于取代HTTP/1.x，它只是修改了HTTP/1.x的请求与应答在网络上传输的方式；这意味着只需增加一个SPDY传输层，现有的所有服务端应用均不用做任何修改。 当使用SPDY的方式传输，HTTP请求会被处理、标记简化和压缩。比如，每一个SPDY端点会持续跟踪每一个在之前的请求中已经发送的HTTP报文头部，从而避免重复发送还未改变的头部。而还未发送的报文的数据部分将在被压缩后被发送

SPDY协议已被HTTP/2协议取代

## 新时代新气象
影响HTTP请求的因素主要是：带宽和延迟。在当今网络情况下，带宽一般不在是瓶颈，所以主要讨论延迟。延迟造成的原因：
1、浏览器线头阻塞：浏览器会因为一些原因阻塞请求
2、DNS查询浪费时间
3、建立连接：HTTP基于TCP协议，TCP的三次握手和慢启动极大增加延迟

## HTTP/1.x中存在的问题
1、连接无法复用：连接无法复用会导致每次请求都经历三次握手和慢启动。三次握手在高延迟的场景下影响较明显，慢启动则对文件类大请求影响大
HTTP/1.0传输数据时，每次都需要重新建立连接，增加延迟
HTTP/1.1虽然加入keep-alive，可以复用一部分连接，但域名分片等情况下仍需要建立多个connetion，耗费资源，给服务器带来了性能压力
2、线头阻塞：导致带宽无法被充分利用，以及后续健康请求被阻塞。HOLB是指在HTTP/1.x中，由于服务器必须按接受请求的顺序发送响应的规则限制，那么假设浏览器在一个（tcp）连接上发送两个请求，那么服务器必须等第一个请求响应完毕才能发送第二个响应——HOLB。虽然现在浏览器允许每个origin建立6个connection，但大量网页需要上百个资源，HOLB依然是主要问题
3、协议开销打：HTTP/1.x中header内容过大，但基本每次请求header基本不变化，增加了传输的成本
4、安全因素：在HTTP中传输的内容都是明文，客户端和服务端双方无法验证身份。