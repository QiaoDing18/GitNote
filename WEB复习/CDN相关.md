title: CDN相关
author: 乔丁
tags:
  - 计算机网络
categories:
  - net
date: 2018-04-27 15:32:00
---
## CDN访问流程
1、用户向浏览器输入xxx.com这个域名，浏览器第一次发现本地没有DNS缓存，则向网站的DNS服务器请求
2、网站的DNS域名解析器设置了CNAME，指向了xxxcdn.com，请求指向了CDN网络中的智能DNS负载均衡系统
3、智能DNS负载均衡系统解析域名，把对用户响应速度最快的IP节点返回给用户
4、用户向该IP节点（CDN服务器）发出请求
5、由于是第一次访问，CDN服务器会向原web站点请求，并缓存内容
6、请求结果发给用户


## CDN原理
CDN网络是在用户和服务器之间增加Cache层，将用户的请求引导到Cache上获得源服务器的数据主要是通过接管DNS实现

1、当用户访问加入CDN服务的网站时，域名解析请求将最终交给**全局负载均衡DNS进行处理**。
2、全局负载均衡DNS通过一组预先定义好的策略，**将当时最接近用户的节点地址提供给用户，使用户能够得到快速的服务**。
3、同时，还与分布在世界各地的所有CDN节点保持通信，搜集各节点的通信状态，**确保不将用户的请求分配到不可用的CDN节点上**，实际上是通过DNS做全局负载均衡
4、每个CDN节点由两部分组成：负载均衡设备、高速缓存服务器

负载均衡设备负责每个节点中各个Cache的负载均衡，保证节点的工作效率
负载均衡设备还负责收集节点与周围环境的信息，保持与负载DNS的通信，实现整个系统的负载均衡。
CDN的管理系统是整个系统能够正常运转的保证。不仅能对系统中的各个子系统和设备进行实时监控，对各种故障产生相应的警告，还可以实时检测到系统中总的流量和各个节点的流量，并保存在系统的数据库中，使网管人员能够方便的进行进一步分析

理论上，最简单的CDN网络有一个负责全局负载均衡的DNS和各节点的一台Cache，即可运行。DNS支持根据用户源IP地址解析不同的IP，实现就近访问。为了保证高可用性，需要监视各节点的流量、健康状态等。一个节点的单台Cache承载数量不够时，才需要多台Cache，多台Cache同时工作，才需要负载均衡器，使Cache群协同工作。